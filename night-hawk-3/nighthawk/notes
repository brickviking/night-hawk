2007-01-27 17:40 NZDT
! Seems to sigsev on 640x480 if I don't get mouse click right, or I try to move.
  If I hit a wall, the wall-detection code doesn't seem to get it right. I get
  bounced off the right hand side, then end up killing game with sigsev.
! On fast video systems, it doesn't really happen but can be simulated with
  the commandline param for "frames per second" being set deliberately low.
2007-07-15 17:05 NZST
! Dion found he had to add -I/usr/X11R6/include  to the CC_FLAGS in config.user
  This will be system-dependent, and is why we used configure/autoconf to begin
  with. *sigh*
~ Changed mess5 for mess4 in src/intro.cc
! on_exit should be changed (src/opengl.cc:581) for this reason from the
  on_exit(3) man page: 
    Avoid this function, and use the standard atexit(3) instead.
  Guess that's another substitute. When we do change, I'll have to modify and
  wraptest the return from atexit. It seems to take weird args

Patch for MacOS X follows, at least until I can get it in a file somewhere.
=== patch begins ===

diff -urp nighthawk-REFERENCE/config.user nighthawk/config.user
--- nighthawk-REFERENCE/config.user	2004-06-12 14:26:03.000000000 +1200
+++ nighthawk/config.user	2007-08-05 20:50:51.000000000 +1200
@@ -13,6 +13,9 @@ CPP		= g++
 
 CC_FLAGS	= -Wall -pipe -O2 \
 		-DINSTALL_DIR='"$(INSTALL_DIR)"' \
-		-DSCORES_FILE='"$(SCORES_FILE)"'
+		-DSCORES_FILE='"$(SCORES_FILE)"' \
+		-I/usr/X11R6/include/ \
+		-F/System/Library/Frameworks/GLUT.framework/ \
+		-framework GLUT
 
-LIB_FLAGS       = -lm -L/usr/X11R6/lib -lX11 -lGL -lGLU -lglut
+LIB_FLAGS       = -lm -L/usr/X11R6/lib -lX11 -lGL -lGLU 
diff -urp nighthawk-REFERENCE/src/defs.h nighthawk/src/defs.h
--- nighthawk-REFERENCE/src/defs.h	2004-06-12 01:46:06.000000000 +1200
+++ nighthawk/src/defs.h	2007-08-05 18:31:53.000000000 +1200
@@ -40,7 +40,7 @@ extern "C" {
 #include <sys/stat.h>
 #include <X11/Xlib.h>
 #include <X11/XKBlib.h>
-#include <GL/glut.h>
+#include <GLUT/glut.h>
 #include <GL/glx.h>
 }
 #include "../version.h"
diff -urp nighthawk-REFERENCE/src/opengl.cc nighthawk/src/opengl.cc
--- nighthawk-REFERENCE/src/opengl.cc	2004-06-12 14:19:02.000000000 +1200
+++ nighthawk/src/opengl.cc	2007-08-05 20:52:08.000000000 +1200
@@ -415,7 +415,7 @@ PUBLIC void end_game(int code)
     printf("Resetting X keyboard.\n");
     XkbSetAutoRepeatRate(x_display, XkbUseCoreKbd, xkb_delay, xkb_rate);
   }
-
+  on_exit_h(0, 0);
   exit(code);
 }
 
@@ -578,7 +578,8 @@ PUBLIC void opengl_init(int argc, char *
 {
   int x, fs_f = 0;
 
-  on_exit(on_exit_h, 0);
+  // ECG: Commented out, as we're now calling it from within end_game()
+  //  on_exit(on_exit_h, 0);
   glutInit(&argc, argv);
   glutInitDisplayMode(mode);
 
diff -urp nighthawk-REFERENCE/src/util/mkprotos2.c nighthawk/src/util/mkprotos2.c
--- nighthawk-REFERENCE/src/util/mkprotos2.c	2003-09-23 00:34:25.000000000 +1200
+++ nighthawk/src/util/mkprotos2.c	2007-08-05 18:19:10.000000000 +1200
@@ -7,7 +7,7 @@
 ****************************************************************************/
 #include <stdio.h>
 #include <string.h>
-#include <malloc.h>
+//#include <malloc.h>
 #include <stdlib.h>
 
 FILE *fp_in;
=== patch ends ===
